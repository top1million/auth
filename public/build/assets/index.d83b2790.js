import{i as y}from"./app.68da1afe.js";const K=y(()=>!window.isSecureContext&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?"WebAuthn only supports secure connections. Please load this page with https scheme.":"Your browser doesn\u2019t currently support WebAuthn.");function _(e){return new TextEncoder().encode(e)}function c(e){const n=new Uint8Array(e);let t="";for(const a of n)t+=String.fromCharCode(a);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function p(e){const n=e.replace(/-/g,"+").replace(/_/g,"/"),t=(4-n.length%4)%4,i=n.padEnd(n.length+t,"="),a=atob(i),s=new ArrayBuffer(a.length),r=new Uint8Array(s);for(let l=0;l<a.length;l++)r[l]=a.charCodeAt(l);return s}function b(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function E(e){const{id:n}=e;return{...e,id:p(n),transports:e.transports}}function g(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class o extends Error{constructor({message:n,code:t,cause:i,name:a}){super(n,{cause:i}),this.name=a!=null?a:i.name,this.code=t}}function T({error:e,options:n}){var i,a;const{publicKey:t}=n;if(!t)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(n.signal instanceof AbortSignal)return new o({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((i=t.authenticatorSelection)==null?void 0:i.requireResidentKey)===!0)return new o({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(((a=t.authenticatorSelection)==null?void 0:a.userVerification)==="required")return new o({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new o({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new o({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return t.pubKeyCredParams.filter(r=>r.type==="public-key").length===0?new o({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new o({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const s=window.location.hostname;if(g(s)){if(t.rp.id!==s)return new o({message:`The RP ID "${t.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new o({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(t.user.id.byteLength<1||t.user.id.byteLength>64)return new o({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new o({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class I{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const n=new AbortController;return this.controller=n,n.signal}}const A=new I,C=["cross-platform","platform"];function m(e){if(!!e&&!(C.indexOf(e)<0))return e}async function N(e){var h;if(!b())throw new Error("WebAuthn is not supported in this browser");const t={publicKey:{...e,challenge:p(e.challenge),user:{...e.user,id:_(e.user.id)},excludeCredentials:(h=e.excludeCredentials)==null?void 0:h.map(E)}};t.signal=A.createNewAbortSignal();let i;try{i=await navigator.credentials.create(t)}catch(d){throw T({error:d,options:t})}if(!i)throw new Error("Registration was not completed");const{id:a,rawId:s,response:r,type:l}=i;let u;typeof r.getTransports=="function"&&(u=r.getTransports());let R;typeof r.getPublicKeyAlgorithm=="function"&&(R=r.getPublicKeyAlgorithm());let f;if(typeof r.getPublicKey=="function"){const d=r.getPublicKey();d!==null&&(f=c(d))}let w;return typeof r.getAuthenticatorData=="function"&&(w=c(r.getAuthenticatorData())),{id:a,rawId:c(s),response:{attestationObject:c(r.attestationObject),clientDataJSON:c(r.clientDataJSON),transports:u,publicKeyAlgorithm:R,publicKey:f,authenticatorData:w},type:l,clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:m(i.authenticatorAttachment)}}function S(e){return new TextDecoder("utf-8").decode(e)}function P(){const e=window.PublicKeyCredential;return e.isConditionalMediationAvailable===void 0?new Promise(n=>n(!1)):e.isConditionalMediationAvailable()}function D({error:e,options:n}){const{publicKey:t}=n;if(!t)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(n.signal instanceof AbortSignal)return new o({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new o({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const i=window.location.hostname;if(g(i)){if(t.rpId!==i)return new o({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new o({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new o({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function U(e,n=!1){var w,h;if(!b())throw new Error("WebAuthn is not supported in this browser");let t;((w=e.allowCredentials)==null?void 0:w.length)!==0&&(t=(h=e.allowCredentials)==null?void 0:h.map(E));const i={...e,challenge:p(e.challenge),allowCredentials:t},a={};if(n){if(!await P())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');a.mediation="conditional",i.allowCredentials=[]}a.publicKey=i,a.signal=A.createNewAbortSignal();let s;try{s=await navigator.credentials.get(a)}catch(d){throw D({error:d,options:a})}if(!s)throw new Error("Authentication was not completed");const{id:r,rawId:l,response:u,type:R}=s;let f;return u.userHandle&&(f=S(u.userHandle)),{id:r,rawId:c(l),response:{authenticatorData:c(u.authenticatorData),clientDataJSON:c(u.clientDataJSON),signature:c(u.signature),userHandle:f},type:R,clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:m(s.authenticatorAttachment)}}export{N as a,b,U as s,K as w};
